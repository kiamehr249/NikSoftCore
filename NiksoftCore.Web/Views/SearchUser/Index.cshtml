@using NiksoftCore.SystemBase.Service
@model NiksoftCore.ViewModel.SearchUserRequest
@{
    ViewData["Title"] = "جستجوی کاربران کسب و کار";
    Layout = "~/Views/Shared/_FaLayout.cshtml";
    var contents = (List<UserProfile>)ViewBag.Contents;
    var pager = (NiksoftCore.Utilities.Pagination)ViewBag.Pager;
    int pageNumber = 0;
}

<style>
.auto-wrap {
  position: relative;
}
.auto-wrap ul {
  padding: 8px;
  list-style: none;
  background: #fff;
  position: absolute;
  width: 100%;
  top: 100%;
  z-index: 10;
  box-shadow: 1px 1px 3px 0px silver;
}

.auto-wrap ul li {
  padding: 3px 8px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.3s ease;
}

.auto-wrap ul li:hover {
  background: #333;
  color: #fff;
}
</style>

<section class="blog" id="blog">
    <div class="section-title dright top_30 bottom_45">
        <h2>@ViewBag.PageTitle</h2>
        <p>نام کسب و کار خود را در اینجا جستجو کنید سپس دکمه احراز هویت را کلیک نمایید</p>
    </div>
    <span>@Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })</span>
    <form method="get">
        <div class="row">
            <div class="col-sm-4">
                <div class="form-group auto-wrap">
                    <label for="txtFirstName" class="control-label">نام شرکت</label>
                    @Html.TextBoxFor(m => m.Title, new { placeholder = "عنوان کسب و کار", @class = "form-inp autocomp", @id = "txtTitle", autocomplete = "off" })
                </div>
            </div>
            <div class="col-sm-3" style="padding-top: 29px;">
                <button type="submit" class="site-button" style="margin: 0;">
                    <i class="fa fa-search"></i>
                </button>
            </div>
        </div>
    </form>
    <br />
    <div class="table-responsive">
        <table class="table table-hover text-center">
            <thead>
                <tr>
                    <th class="text-center" width="30px">ردیف</th>
                    <th class="text-center">نام</th>
                    <th class="text-center">آدرس</th>
                    <th class="text-center">شماره تماس</th>
                    <th class="text-center" width="100px">سایر</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in contents)
                {
                    pageNumber++;
                <tr>
                    <td>@(pager.StartIndex + pageNumber)</td>
                    <td>
                        <span>@item.CompanyName </span>
                    </td>
                    <td>@item.Address</td>
                    <td>
                        @item.Tel
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a href="/SearchUser/RegisterUserInfo/?Id=@item.Id" class="btn btn-warning btn-sm">
                                احراز هویت
                            </a>
                        </div>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
</section>

<script>
    $(document).ready(function () {
        $('#txtTitle').on('keyup', function () {
            var pri = $($(this).parents('.auto-wrap')[0]);
            getProfiles(this.value, pri);
        });
    });

    function getProfiles(txt, target) {
        $.post('/api/base/AccountApi/SearchProfile', { title: txt }, function (data, status) {
            var res = createAutoCom(data.data);
            $('.auto-c').remove();
            $('.auto-c li').off('click');
            target.append(res);
            bindClickAuto();
        });
    }

    function bindClickAuto() {
        $('.auto-c li').on('click', function () {
            var pri = $($(this).parents('.auto-wrap')[0]);
            console.log(pri);
            pri.find('.autocomp').val($(this).text());
            $('.auto-c').remove();
        });
    }

    function createAutoCom(entryList) {
        if (entryList == null || entryList == '' || entryList.lenght == 0) {
            return '';
        }

        var html = '<ul class="auto-c">'
        entryList.forEach(function (item, index) {
            html += ('<li>' + item.title + '</li>');
        });
        html += "</ul>";
        return html;
    }
</script>